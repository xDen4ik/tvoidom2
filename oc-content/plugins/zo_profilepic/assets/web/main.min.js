$(function(){var h=".pp_upload";var f=".pp_modal";var c=document.querySelector(h+" .pp_modal_image");var j=document.querySelector(h+" .pp_input");if(j===null){return}var l=document.querySelector(h+" .pp_modal_image_edit");var d=document.querySelector(".pp_new");var b=$(".pp_new img");var i=$(h+" .pp_crop");var a=$(h+" .pp_data");var e={aspectRatio:1,viewMode:0,dragMode:"move",};var g;var k=new Custombox.modal({content:{effect:"fadein",target:f}});j.addEventListener("change",function(r){var q=r.target.files;var n=function(s){j.value="";c.src=s;k.open()};var m;var p;var o;if(q&&q.length>0){p=q[0];if(URL){n(URL.createObjectURL(p))}else{if(FileReader){m=new FileReader();m.onload=function(s){n(m.result)};m.readAsDataURL(p)}}}});document.addEventListener("custombox:content:open",function(){document.querySelector(f).style.display="block";g=new Cropper(c,e)});document.addEventListener("custombox:overlay:close",function(){document.querySelector(f).style.display="none";g.destroy();g=null});l.onclick=function(n){var r=n||window.event;var q=r.target||r.srcElement;console.info(q);var p;var m;var s;var o;if(!g){return}while(q!==this){if(q.getAttribute("data-method")){break}q=q.parentNode}if(q===this||q.disabled||q.className.indexOf("disabled")>-1){return}o={method:q.getAttribute("data-method"),target:q.getAttribute("data-target"),option:q.getAttribute("data-option")||undefined,secondOption:q.getAttribute("data-second-option")||undefined};p=g.cropped;if(o.method){if(typeof o.target!=="undefined"){s=document.querySelector(o.target);if(!q.hasAttribute("data-option")&&o.target&&s){try{o.option=JSON.parse(s.value)}catch(r){console.log(r.message)}}}switch(o.method){case"rotate":if(p&&e.viewMode>0){g.clear()}break;case"getCroppedCanvas":try{o.option=JSON.parse(o.option)}catch(r){console.log(r.message)}if(uploadedImageType==="image/jpeg"){if(!o.option){o.option={}}o.option.fillColor="#fff"}break}m=g[o.method](o.option,o.secondOption);switch(o.method){case"rotate":if(p&&e.viewMode>0){g.crop()}break;case"scaleX":case"scaleY":q.setAttribute("data-option",-o.option);break;case"getCroppedCanvas":if(m){if(!download.disabled){download.download=uploadedImageName;download.href=m.toDataURL(uploadedImageType)}}break;case"destroy":g=null;if(uploadedImageURL){URL.revokeObjectURL(uploadedImageURL);uploadedImageURL="";c.src=originalImageURL}break}if(typeof m==="object"&&m!==g&&s){try{s.value=JSON.stringify(m)}catch(r){console.log(r.message)}}}};$(i).on("click",function(){var m;var n;if(g){m=g.getCroppedCanvas({width:$profilepic_size,height:$profilepic_size,});n=m.toDataURL();a.val(n).trigger("change");d.style.display="block";b.attr("src",n)}Custombox.modal.closeAll()});$(".pp_file_input").on("change",function(){$(this).on("focus",function(){$(this).addClass("has-focus")}).on("blur",function(){$(this).removeClass("has-focus")})});a.on("change",function(){if($(this).val()){$("label[for=pp_input_]").find("span").html($profilepic_uploaded)}else{$("label[for=pp_input_]").find("span").html($profilepic_not_uploaded)}})});